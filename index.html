<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Database - Govt ITI Udhampur</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #1abc9c;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* Header with banner */
        .header-banner {
            height: 180px;
            background: linear-gradient(to right, #2c3e50, #4ca1af);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .banner-content {
            text-align: center;
            color: white;
            z-index: 2;
        }
        
        .banner-content h1 {
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .banner-content p {
            font-size: 18px;
            max-width: 600px;
        }
        
        .banner-upload {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .banner-upload:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .logo-container {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .logo-container img {
            max-width: 90%;
            max-height: 90%;
        }
        
        .logo-upload {
            position: absolute;
            bottom: -10px;
            right: -10px;
            background: var(--primary);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        /* Home Page */
        .home-container {
            padding: 30px;
            text-align: center;
        }
        
        .home-welcome {
            margin-bottom: 40px;
        }
        
        .home-welcome h2 {
            color: var(--secondary);
            margin-bottom: 15px;
            font-size: 28px;
        }
        
        .home-welcome p {
            color: #666;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feature-card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 40px;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .feature-card h3 {
            margin-bottom: 10px;
            color: var(--secondary);
        }
        
        .feature-card p {
            color: #666;
            line-height: 1.5;
        }
        
        /* Footer */
        .footer {
            background: var(--secondary);
            color: white;
            padding: 20px;
            text-align: center;
            margin-top: auto;
        }
        
        .developer-info {
            margin-bottom: 15px;
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        .social-links a {
            color: white;
            font-size: 20px;
            transition: color 0.3s;
        }
        
        .social-links a:hover {
            color: var(--primary);
        }
        
        /* Rest of the styles remain the same as previous version */
        .app-container {
            display: flex;
            min-height: 600px;
        }
        
        /* Login Page */
        #loginPage {
            padding: 40px;
            width: 100%;
            text-align: center;
        }
        
        .login-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .login-form {
            margin-top: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-info {
            background-color: var(--info);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--secondary);
            color: white;
            padding: 20px 0;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            padding: 15px 20px;
            border-left: 4px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sidebar-menu li:hover, .sidebar-menu li.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-left-color: var(--primary);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            background-color: #f5f7fa;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .card-title {
            font-size: 20px;
            color: var(--dark);
        }
        
        /* Dashboard */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .stat-label {
            color: #777;
            font-size: 14px;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
        }
        
        tr:hover {
            background-color: #f1f7ff;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .edit-btn {
            background-color: var(--warning);
            color: white;
        }
        
        .delete-btn {
            background-color: var(--danger);
            color: white;
        }
        
        /* Forms */
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-field {
            flex: 1 1 calc(50% - 20px);
            min-width: 250px;
        }
        
        .form-field label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-field input, .form-field select, .form-field textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .photo-upload {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .photo-preview {
            width: 120px;
            height: 120px;
            border: 2px dashed #ddd;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .photo-preview img {
            max-width: 100%;
            max-height: 100%;
        }
        
        /* Toggle between login and main app */
        #app {
            display: none;
        }
        
        /* Responsive design */
        @media (max-width: 900px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 10px;
            }
            
            .sidebar-menu {
                display: flex;
                overflow-x: auto;
            }
            
            .sidebar-menu li {
                padding: 10px 15px;
                white-space: nowrap;
            }
            
            .header-banner {
                height: 150px;
                flex-direction: column;
                text-align: center;
                padding-top: 10px;
            }
            
            .logo-container {
                position: relative;
                margin-bottom: 10px;
                left: 0;
                top: 0;
            }
            
            .banner-upload {
                position: relative;
                margin-top: 10px;
                right: 0;
                top: 0;
            }
        }
        
        /* File upload styling */
        .file-upload {
            background-color: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload:hover {
            background-color: #e9ecef;
            border-color: var(--primary);
        }
        
        .file-upload i {
            font-size: 48px;
            color: #6c757d;
            margin-bottom: 10px;
        }
        
        /* Trades management */
        .trade-list {
            list-style: none;
            margin: 20px 0;
        }
        
        .trade-item {
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Dashboard charts placeholder */
        .chart-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin: 20px 0;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #777;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .close {
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            display: none;
            animation: slideIn 0.3s ease;
            z-index: 1100;
        }
        
        .success {
            background-color: var(--success);
        }
        
        .error {
            background-color: var(--danger);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Custom fields styling */
        .custom-fields-container {
            margin: 20px 0;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
        }
        
        .field-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .field-row input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .field-actions {
            display: flex;
            gap: 5px;
        }
        
        /* Home page link */
        .home-link {
            position: absolute;
            top: 15px;
            left: 110px;
            color: white;
            text-decoration: none;
            font-weight: 600;
            padding: 8px 15px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }
        
        .home-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Home Page -->
        <div id="homePage">
            <div class="header-banner">
                <div class="logo-container">
                    <img src="https://upload.wikimedia.org/wikipedia/en/2/29/India_ITI_logo.png" alt="ITI Logo" id="logoImage">
                    <div class="logo-upload" onclick="document.getElementById('logoUpload').click()">
                        <i class="fas fa-camera"></i>
                        <input type="file" id="logoUpload" accept="image/*" style="display: none;" onchange="uploadLogo(event)">
                    </div>
                </div>
                
                <div class="banner-content">
                    <h1>Govt ITI Udhampur</h1>
                    <p>Student Database Management System</p>
                </div>
                
                <div class="banner-upload" onclick="document.getElementById('bannerUpload').click()">
                    <i class="fas fa-upload"></i> Upload Banner
                    <input type="file" id="bannerUpload" accept="image/*" style="display: none;" onchange="uploadBanner(event)">
                </div>
                
                <a href="#" class="home-link" onclick="showLoginPage()">
                    <i class="fas fa-sign-in-alt"></i> Login
                </a>
            </div>
            
            <div class="home-container">
                <div class="home-welcome">
                    <h2>Welcome to Student Database Management System</h2>
                    <p>This platform helps manage student information, trades, and user accounts for Govt ITI Udhampur. 
                       Administrators can manage the complete system, teachers can manage students in their assigned trades, 
                       and students can view and update their own information.</p>
                </div>
                
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                        <h3>Student Management</h3>
                        <p>Easily add, edit, and manage student records with photos and custom fields.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-tools"></i>
                        </div>
                        <h3>Trade Management</h3>
                        <p>Create and manage different trades offered at your institution.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-file-excel"></i>
                        </div>
                        <h3>Bulk Upload</h3>
                        <p>Import student data from Excel files for quick population of your database.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-user-cog"></i>
                        </div>
                        <h3>Role-based Access</h3>
                        <p>Different access levels for administrators, teachers, and students.</p>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <div class="developer-info">
                    <p>Designed and developed by Rahul Thakur</p>
                    <p>For any query please mail at <a href="mailto:rahul.thakur1@jk.gov.in" style="color: #fff;">rahul.thakur1@jk.gov.in</a></p>
                </div>
                
                <div class="social-links">
                    <a href="#" title="YouTube"><i class="fab fa-youtube"></i></a>
                    <a href="#" title="Facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" title="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" title="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
                </div>
            </div>
        </div>
        
        <!-- Login Page -->
        <div id="loginPage" style="display: none;">
            <div class="login-container">
                <h2>Govt ITI Udhampur</h2>
                <p>Student Database Management System</p>
                
                <div class="login-form">
                    <div class="form-group">
                        <label for="loginUsername">Username</label>
                        <input type="text" id="loginUsername" placeholder="Enter your username">
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password">
                    </div>
                    
                    <div class="form-group">
                        <label for="loginRole">Login as</label>
                        <select id="loginRole">
                            <option value="admin">Admin</option>
                            <option value="teacher">Teacher</option>
                            <option value="student">Student</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%;" onclick="login()">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <a href="#" onclick="showHomePage()"><i class="fas fa-arrow-left"></i> Back to Home</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Application -->
        <div id="app">
            <header>
                <h1>Student Data Base Govt ITI Udhampur</h1>
                <div style="margin-top: 10px;">
                    <span id="currentUser">Logged in as: Admin</span>
                    <button class="btn btn-danger" style="margin-left: 20px;" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </header>
            
            <div class="app-container">
                <!-- Sidebar -->
                <div class="sidebar">
                    <ul class="sidebar-menu">
                        <li class="active" data-page="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</li>
                        <li data-page="students"><i class="fas fa-user-graduate"></i> Students</li>
                        <li data-page="trades"><i class="fas fa-tools"></i> Trades</li>
                        <li data-page="bulkUpload"><i class="fas fa-file-excel"></i> Bulk Upload</li>
                        <li data-page="adminPanel" id="adminPanelItem"><i class="fas fa-user-cog"></i> Admin Panel</li>
                        <li data-page="settings" id="settingsItem"><i class="fas fa-cog"></i> Settings</li>
                    </ul>
                </div>
                
                <!-- Main Content -->
                <div class="main-content">
                    <!-- Dashboard Page -->
                    <div class="page active" id="dashboard">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Dashboard Overview</h2>
                                <span id="lastUpdated">Last updated: Just now</span>
                            </div>
                            
                            <div class="stats-container">
                                <div class="stat-card">
                                    <div class="stat-label">Total Students</div>
                                    <div class="stat-value" id="totalStudents">0</div>
                                    <div id="newStudents">+0 this month</div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-label">Active Trades</div>
                                    <div class="stat-value" id="totalTrades">0</div>
                                    <div id="tradeInfo">Across 0 departments</div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-label">Attendance Rate</div>
                                    <div class="stat-value" id="attendanceRate">0%</div>
                                    <div>This month</div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-label">New Applications</div>
                                    <div class="stat-value" id="newApplications">0</div>
                                    <div>Pending review</div>
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <div>
                                    <i class="fas fa-chart-bar" style="font-size: 48px; margin-bottom: 20px;"></i>
                                    <h3>Enrollment Statistics</h3>
                                    <p>Visualization of student enrollment across trades</p>
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <div>
                                    <i class="fas fa-chart-pie" style="font-size: 48px; margin-bottom: 20px;"></i>
                                    <h3>Performance Overview</h3>
                                    <p>Student performance analytics by trade</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Students Page -->
                    <div class="page" id="students">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Student Management</h2>
                                <button class="btn btn-primary" id="addStudentBtn" onclick="showAddStudentForm()">
                                    <i class="fas fa-plus"></i> Add New Student
                                </button>
                            </div>
                            
                            <div class="form-group">
                                <input type="text" id="studentSearch" placeholder="Search students..." style="max-width: 300px;" oninput="filterStudents()">
                            </div>
                            
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Photo</th>
                                        <th>Name</th>
                                        <th>Trade</th>
                                        <th>Enrollment Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="studentTableBody">
                                    <!-- Student data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Trades Page -->
                    <div class="page" id="trades">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Trade Management</h2>
                                <button class="btn btn-primary" id="addTradeBtn" onclick="showAddTradeForm()">
                                    <i class="fas fa-plus"></i> Add New Trade
                                </button>
                            </div>
                            
                            <ul class="trade-list" id="tradeList">
                                <!-- Trade data will be populated here -->
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Bulk Upload Page -->
                    <div class="page" id="bulkUpload">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Bulk Upload Students</h2>
                            </div>
                            
                            <div class="file-upload" id="excelUploadArea">
                                <i class="fas fa-file-excel"></i>
                                <h3>Upload Excel File</h3>
                                <p>Click here or drag and drop your Excel file</p>
                                <input type="file" id="excelFile" accept=".xlsx, .xls" style="display: none;" onchange="handleExcelUpload(this.files)">
                                <button class="btn btn-primary" style="margin-top: 10px;" onclick="document.getElementById('excelFile').click()">
                                    <i class="fas fa-upload"></i> Select File
                                </button>
                            </div>
                            
                            <div>
                                <h3>Instructions:</h3>
                                <ul>
                                    <li>Download the template file <a href="#" onclick="downloadTemplate()">here</a></li>
                                    <li>Ensure all required fields are filled</li>
                                    <li>Save the file in Excel format (.xlsx)</li>
                                    <li>Upload using the button above</li>
                                </ul>
                                
                                <div id="uploadProgress" style="margin-top: 20px; display: none;">
                                    <div style="display: flex; justify-content: space-between;">
                                        <span>Processing...</span>
                                        <span id="progressPercent">0%</span>
                                    </div>
                                    <div style="height: 10px; background: #f0f0f0; border-radius: 5px; margin-top: 5px;">
                                        <div id="progressBar" style="height: 100%; width: 0%; background: var(--primary); border-radius: 5px; transition: width 0.3s;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Admin Panel Page -->
                    <div class="page" id="adminPanel">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Admin Panel - User Management</h2>
                                <button class="btn btn-primary" id="addUserBtn" onclick="showAddUserForm()">
                                    <i class="fas fa-plus"></i> Create New User
                                </button>
                            </div>
                            
                            <table>
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Role</th>
                                        <th>Assigned Trade</th>
                                        <th>Created On</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="userTableBody">
                                    <!-- User data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Settings Page -->
                    <div class="page" id="settings">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Settings</h2>
                            </div>
                            
                            <h3 style="margin: 20px 0;">Student Information Fields</h3>
                            
                            <div class="form-row">
                                <div class="form-field">
                                    <label>Add New Field</label>
                                    <input type="text" id="newFieldName" placeholder="Field name">
                                </div>
                                <div class="form-field">
                                    <label>Field Type</label>
                                    <select id="newFieldType">
                                        <option>Text</option>
                                        <option>Number</option>
                                        <option>Date</option>
                                        <option>Dropdown</option>
                                    </select>
                                </div>
                            </div>
                            
                            <button class="btn btn-success" onclick="addNewField()">
                                <i class="fas fa-plus"></i> Add Field
                            </button>
                            
                            <div style="margin-top: 30px;">
                                <h3>Current Fields</h3>
                                <ul class="trade-list" id="fieldList">
                                    <!-- Field data will be populated here -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <div class="developer-info">
                    <p>Designed and developed by Rahul Thakur</p>
                    <p>For any query please mail at <a href="mailto:rahul.thakur1@jk.gov.in" style="color: #fff;">rahul.thakur1@jk.gov.in</a></p>
                </div>
                
                <div class="social-links">
                    <a href="#" title="YouTube"><i class="fab fa-youtube"></i></a>
                    <a href="#" title="Facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" title="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" title="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div class="modal" id="studentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalStudentTitle">Add New Student</h2>
                <span class="close" onclick="closeModal('studentModal')">&times;</span>
            </div>
            <form id="studentForm" onsubmit="saveStudent(event)">
                <input type="hidden" id="studentId">
                <div class="form-row">
                    <div class="form-field">
                        <label for="studentName">Full Name</label>
                        <input type="text" id="studentName" required>
                    </div>
                    <div class="form-field">
                        <label for="studentTrade">Trade</label>
                        <select id="studentTrade" required>
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-field">
                        <label for="studentEmail">Email</label>
                        <input type="email" id="studentEmail">
                    </div>
                    <div class="form-field">
                        <label for="studentPhone">Phone</label>
                        <input type="tel" id="studentPhone">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-field">
                        <label for="studentEnrollmentDate">Enrollment Date</label>
                        <input type="date" id="studentEnrollmentDate" required>
                    </div>
                    <div class="form-field">
                        <label for="studentStatus">Status</label>
                        <select id="studentStatus" required>
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                            <option value="On Leave">On Leave</option>
                        </select>
                    </div>
                </div>
                
                <!-- Custom Fields Section -->
                <div class="custom-fields-container">
                    <h3>Additional Information</h3>
                    <div id="customFieldsContainer">
                        <!-- Custom fields will be added here -->
                    </div>
                    <button type="button" class="btn btn-info" onclick="addCustomField()" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Add Custom Field
                    </button>
                </div>
                
                <div class="photo-upload">
                    <div class="photo-preview" id="photoPreview">
                        <i class="fas fa-user" style="font-size: 48px; color: #ccc;"></i>
                    </div>
                    <div>
                        <input type="file" id="studentPhoto" accept="image/*" style="display: none;" onchange="previewPhoto(event)">
                        <button type="button" class="btn btn-info" onclick="document.getElementById('studentPhoto').click()">
                            <i class="fas fa-upload"></i> Upload Photo
                        </button>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" onclick="closeModal('studentModal')">Cancel</button>
                    <button type="submit" class="btn btn-success">Save Student</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Trade Modal -->
    <div class="modal" id="tradeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTradeTitle">Add New Trade</h2>
                <span class="close" onclick="closeModal('tradeModal')">&times;</span>
            </div>
            <form id="tradeForm" onsubmit="saveTrade(event)">
                <input type="hidden" id="tradeId">
                <div class="form-row">
                    <div class="form-field">
                        <label for="tradeName">Trade Name</label>
                        <input type="text" id="tradeName" required>
                    </div>
                    <div class="form-field">
                        <label for="tradeDuration">Duration (years)</label>
                        <input type="number" id="tradeDuration" min="1" max="4" step="0.5" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-field">
                        <label for="tradeSeats">Available Seats</label>
                        <input type="number" id="tradeSeats" min="1" required>
                    </div>
                    <div class="form-field">
                        <label for="tradeDepartment">Department</label>
                        <input type="text" id="tradeDepartment" required>
                    </div>
                </div>
                
                <div class="form-field">
                    <label for="tradeDescription">Description</label>
                    <textarea id="tradeDescription" rows="3"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" onclick="closeModal('tradeModal')">Cancel</button>
                    <button type="submit" class="btn btn-success">Save Trade</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalUserTitle">Create New User</h2>
                <span class="close" onclick="closeModal('userModal')">&times;</span>
            </div>
            <form id="userForm" onsubmit="saveUser(event)">
                <input type="hidden" id="userId">
                <div class="form-row">
                    <div class="form-field">
                        <label for="userUsername">Username</label>
                        <input type="text" id="userUsername" required>
                    </div>
                    <div class="form-field">
                        <label for="userRole">Role</label>
                        <select id="userRole" required onchange="toggleTradeSelection()">
                            <option value="admin">Admin</option>
                            <option value="teacher">Teacher</option>
                            <option value="student">Student</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-field">
                        <label for="userPassword">Password</label>
                        <input type="password" id="userPassword" required>
                    </div>
                    <div class="form-field">
                        <label for="userConfirmPassword">Confirm Password</label>
                        <input type="password" id="userConfirmPassword" required>
                    </div>
                </div>
                
                <div class="form-field" id="tradeSelectionField" style="display: none;">
                    <label for="userTrade">Assign Trade (for teachers)</label>
                    <select id="userTrade">
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>
                
                <div class="form-field">
                    <label for="userEmail">Email</label>
                    <input type="email" id="userEmail">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" onclick="closeModal('userModal')">Cancel</button>
                    <button type="submit" class="btn btn-success">Create User</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // Data storage
        let students = JSON.parse(localStorage.getItem('students')) || [];
        let trades = JSON.parse(localStorage.getItem('trades')) || [
            { id: 1, name: 'Electrician', duration: 2, seats: 40, department: 'Electrical' },
            { id: 2, name: 'Fitter', duration: 2, seats: 35, department: 'Mechanical' },
            { id: 3, name: 'Computer Operator', duration: 1, seats: 30, department: 'IT' }
        ];
        let users = JSON.parse(localStorage.getItem('users')) || [
            { id: 1, username: 'admin', password: 'admin123', role: 'admin', email: 'admin@itiuddhampur.edu' },
            { id: 2, username: 'teacher', password: 'teacher123', role: 'teacher', email: 'teacher@itiuddhampur.edu', assignedTrade: 1 },
            { id: 3, username: 'student', password: 'student123', role: 'student', email: 'student@itiuddhampur.edu' }
        ];
        let fields = JSON.parse(localStorage.getItem('fields')) || [
            { name: 'Full Name', type: 'Text', required: true },
            { name: 'Date of Birth', type: 'Date', required: true },
            { name: 'Father\'s Name', type: 'Text', required: true }
        ];
        
        // Custom fields for students
        let customFields = JSON.parse(localStorage.getItem('customFields')) || [];
        
        // Current user info
        let currentUser = null;
        
        // Initialize the application
        function init() {
            // Save initial data if not exists
            if (!localStorage.getItem('trades')) {
                localStorage.setItem('trades', JSON.stringify(trades));
            }
            if (!localStorage.getItem('users')) {
                localStorage.setItem('users', JSON.stringify(users));
            }
            if (!localStorage.getItem('fields')) {
                localStorage.setItem('fields', JSON.stringify(fields));
            }
            if (!localStorage.getItem('customFields')) {
                localStorage.setItem('customFields', JSON.stringify(customFields));
            }
            
            // Load data
            students = JSON.parse(localStorage.getItem('students')) || [];
            trades = JSON.parse(localStorage.getItem('trades'));
            users = JSON.parse(localStorage.getItem('users'));
            fields = JSON.parse(localStorage.getItem('fields'));
            customFields = JSON.parse(localStorage.getItem('customFields'));
            
            // Render data
            renderStudentTable();
            renderTradeList();
            renderUserTable();
            renderFieldList();
            updateDashboard();
            
            // Populate trade dropdowns
            populateTradeDropdowns();
        }
        
        // Populate trade dropdowns
        function populateTradeDropdowns() {
            const tradeSelect = document.getElementById('studentTrade');
            tradeSelect.innerHTML = '';
            trades.forEach(trade => {
                const option = document.createElement('option');
                option.value = trade.id;
                option.textContent = trade.name;
                tradeSelect.appendChild(option);
            });
            
            const userTradeSelect = document.getElementById('userTrade');
            userTradeSelect.innerHTML = '';
            trades.forEach(trade => {
                const option = document.createElement('option');
                option.value = trade.id;
                option.textContent = trade.name;
                userTradeSelect.appendChild(option);
            });
        }
        
        // Show home page
        function showHomePage() {
            document.getElementById('homePage').style.display = 'block';
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('app').style.display = 'none';
        }
        
        // Show login page
        function showLoginPage() {
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('loginPage').style.display = 'block';
            document.getElementById('app').style.display = 'none';
        }
        
        // Upload banner
        function uploadBanner(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.querySelector('.header-banner').style.backgroundImage = `url(${e.target.result})`;
                    document.querySelector('.header-banner').style.backgroundSize = 'cover';
                    document.querySelector('.header-banner').style.backgroundPosition = 'center';
                    localStorage.setItem('bannerImage', e.target.result);
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Upload logo
        function uploadLogo(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('logoImage').src = e.target.result;
                    localStorage.setItem('logoImage', e.target.result);
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Load saved banner and logo
        function loadSavedImages() {
            const bannerImage = localStorage.getItem('bannerImage');
            const logoImage = localStorage.getItem('logoImage');
            
            if (bannerImage) {
                document.querySelector('.header-banner').style.backgroundImage = `url(${bannerImage})`;
                document.querySelector('.header-banner').style.backgroundSize = 'cover';
                document.querySelector('.header-banner').style.backgroundPosition = 'center';
            }
            
            if (logoImage) {
                document.getElementById('logoImage').src = logoImage;
            }
        }
        
        // Login function
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const role = document.getElementById('loginRole').value;
            
            // Find user
            const user = users.find(u => u.username === username && u.password === password && u.role === role);
            
            if (user) {
                currentUser = user;
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                document.getElementById('currentUser').textContent = `Logged in as: ${role.charAt(0).toUpperCase() + role.slice(1)} (${username})`;
                showNotification('Login successful!', 'success');
                
                // Apply role-based restrictions
                applyRoleRestrictions();
            } else {
                showNotification('Invalid username or password', 'error');
            }
        }
        
        // Apply role-based restrictions
        function applyRoleRestrictions() {
            const adminPanelItem = document.getElementById('adminPanelItem');
            const settingsItem = document.getElementById('settingsItem');
            const addStudentBtn = document.getElementById('addStudentBtn');
            const addTradeBtn = document.getElementById('addTradeBtn');
            const addUserBtn = document.getElementById('addUserBtn');
            
            if (currentUser.role === 'admin') {
                // Admin has full access
                adminPanelItem.style.display = 'list-item';
                settingsItem.style.display = 'list-item';
                addStudentBtn.disabled = false;
                addTradeBtn.disabled = false;
                addUserBtn.disabled = false;
            } else if (currentUser.role === 'teacher') {
                // Teacher can only manage students in their assigned trade
                adminPanelItem.style.display = 'none';
                settingsItem.style.display = 'none';
                addStudentBtn.disabled = false;
                addTradeBtn.disabled = true;
                addUserBtn.disabled = true;
                
                // Filter students to only show those in the teacher's assigned trade
                if (currentUser.assignedTrade) {
                    filterStudentsByTrade(currentUser.assignedTrade);
                }
            } else if (currentUser.role === 'student') {
                // Student can only view their own details
                adminPanelItem.style.display = 'none';
                settingsItem.style.display = 'none';
                addStudentBtn.disabled = true;
                addTradeBtn.disabled = true;
                addUserBtn.disabled = true;
                
                // Show only the student's own record
                filterStudentOwnRecord();
            }
        }
        
        // Filter students by trade (for teachers)
        function filterStudentsByTrade(tradeId) {
            const tbody = document.getElementById('studentTableBody');
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const tradeCell = row.cells[3];
                if (tradeCell.textContent === trades.find(t => t.id === tradeId)?.name) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Filter student's own record (for students)
        function filterStudentOwnRecord() {
            const tbody = document.getElementById('studentTableBody');
            const rows = tbody.querySelectorAll('tr');
            
            // For demo purposes, we'll assume the student's record has their username
            rows.forEach(row => {
                const nameCell = row.cells[2];
                if (nameCell.textContent.toLowerCase().includes(currentUser.username)) {
                    row.style.display = '';
                    
                    // Remove edit and delete buttons for student view
                    const actionCell = row.cells[6];
                    actionCell.innerHTML = '<button class="action-btn edit-btn" onclick="editStudentOwnRecord()"><i class="fas fa-edit"></i></button>';
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Hide the "Add New Student" button
            document.getElementById('addStudentBtn').style.display = 'none';
        }
        
        // Edit student's own record
        function editStudentOwnRecord() {
            // For demo purposes, we'll just show a message
            showNotification('You can only edit your own profile information', 'info');
            // In a real application, you would open a form with limited editable fields
        }
        
        // Logout function
        function logout() {
            currentUser = null;
            document.getElementById('homePage').style.display = 'block';
            document.getElementById('app').style.display = 'none';
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        }
        
        // Show notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Modal functions
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        // Toggle trade selection based on user role
        function toggleTradeSelection() {
            const role = document.getElementById('userRole').value;
            const tradeSelectionField = document.getElementById('tradeSelectionField');
            
            if (role === 'teacher') {
                tradeSelectionField.style.display = 'block';
            } else {
                tradeSelectionField.style.display = 'none';
            }
        }
        
        // Student functions
        function showAddStudentForm() {
            document.getElementById('modalStudentTitle').textContent = 'Add New Student';
            document.getElementById('studentForm').reset();
            document.getElementById('studentId').value = '';
            document.getElementById('photoPreview').innerHTML = '<i class="fas fa-user" style="font-size: 48px; color: #ccc;"></i>';
            
            // Clear custom fields
            document.getElementById('customFieldsContainer').innerHTML = '';
            
            // Add custom fields
            customFields.forEach((field, index) => {
                addCustomFieldToForm(field.name, field.type, '');
            });
            
            openModal('studentModal');
        }
        
        function addCustomField() {
            const fieldName = prompt('Enter field name:');
            if (fieldName) {
                const fieldType = prompt('Enter field type (text, number, date):', 'text');
                if (fieldType) {
                    customFields.push({ name: fieldName, type: fieldType });
                    localStorage.setItem('customFields', JSON.stringify(customFields));
                    addCustomFieldToForm(fieldName, fieldType, '');
                    showNotification('Custom field added', 'success');
                }
            }
        }
        
        function addCustomFieldToForm(name, type, value) {
            const container = document.getElementById('customFieldsContainer');
            const fieldRow = document.createElement('div');
            fieldRow.className = 'field-row';
            
            fieldRow.innerHTML = `
                <label>${name}:</label>
                <input type="${type}" name="custom_${name}" value="${value}" placeholder="${name}">
                <div class="field-actions">
                    <button type="button" class="action-btn delete-btn" onclick="removeCustomField('${name}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(fieldRow);
        }
        
        function removeCustomField(name) {
            if (confirm('Are you sure you want to remove this field?')) {
                customFields = customFields.filter(f => f.name !== name);
                localStorage.setItem('customFields', JSON.stringify(customFields));
                
                // Reopen the form to refresh custom fields
                const studentId = document.getElementById('studentId').value;
                if (studentId) {
                    editStudent(parseInt(studentId));
                } else {
                    showAddStudentForm();
                }
                
                showNotification('Custom field removed', 'success');
            }
        }
        
        function saveStudent(e) {
            e.preventDefault();
            
            const studentId = document.getElementById('studentId').value;
            const studentData = {
                name: document.getElementById('studentName').value,
                tradeId: parseInt(document.getElementById('studentTrade').value),
                email: document.getElementById('studentEmail').value,
                phone: document.getElementById('studentPhone').value,
                enrollmentDate: document.getElementById('studentEnrollmentDate').value,
                status: document.getElementById('studentStatus').value,
                photo: document.getElementById('photoPreview').querySelector('img')?.src || ''
            };
            
            // Get custom fields data
            const customFieldsData = {};
            customFields.forEach(field => {
                const input = document.querySelector(`input[name="custom_${field.name}"]`);
                if (input) {
                    customFieldsData[field.name] = input.value;
                }
            });
            
            studentData.customFields = customFieldsData;
            
            if (studentId) {
                // Update existing student
                const index = students.findIndex(s => s.id === parseInt(studentId));
                if (index !== -1) {
                    students[index] = { ...students[index], ...studentData };
                    showNotification('Student updated successfully!', 'success');
                }
            } else {
                // Add new student
                const newId = students.length > 0 ? Math.max(...students.map(s => s.id)) + 1 : 1;
                students.push({ id: newId, ...studentData });
                showNotification('Student added successfully!', 'success');
            }
            
            localStorage.setItem('students', JSON.stringify(students));
            renderStudentTable();
            updateDashboard();
            closeModal('studentModal');
        }
        
        function renderStudentTable() {
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';
            
            if (students.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No students found</td></tr>';
                return;
            }
            
            students.forEach(student => {
                const trade = trades.find(t => t.id === student.tradeId);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>ITI${student.id.toString().padStart(4, '0')}</td>
                    <td>${student.photo ? `<img src="${student.photo}" width="40" height="40" style="border-radius: 50%;">` : '<i class="fas fa-user"></i>'}</td>
                    <td>${student.name}</td>
                    <td>${trade ? trade.name : 'N/A'}</td>
                    <td>${student.enrollmentDate}</td>
                    <td><span style="color: ${student.status === 'Active' ? 'green' : student.status === 'On Leave' ? 'orange' : 'red'};">${student.status}</span></td>
                    <td class="action-buttons">
                        <button class="action-btn edit-btn" onclick="editStudent(${student.id})"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn" onclick="deleteStudent(${student.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Reapply role-based restrictions after rendering
            if (currentUser) {
                applyRoleRestrictions();
            }
        }
        
        function editStudent(id) {
            const student = students.find(s => s.id === id);
            if (student) {
                document.getElementById('modalStudentTitle').textContent = 'Edit Student';
                document.getElementById('studentId').value = student.id;
                document.getElementById('studentName').value = student.name;
                document.getElementById('studentTrade').value = student.tradeId;
                document.getElementById('studentEmail').value = student.email || '';
                document.getElementById('studentPhone').value = student.phone || '';
                document.getElementById('studentEnrollmentDate').value = student.enrollmentDate;
                document.getElementById('studentStatus').value = student.status;
                
                if (student.photo) {
                    document.getElementById('photoPreview').innerHTML = `<img src="${student.photo}" style="max-width: 100%; max-height: 100%;">`;
                } else {
                    document.getElementById('photoPreview').innerHTML = '<i class="fas fa-user" style="font-size: 48px; color: #ccc;"></i>';
                }
                
                // Clear custom fields
                document.getElementById('customFieldsContainer').innerHTML = '';
                
                // Add custom fields with values
                customFields.forEach(field => {
                    const value = student.customFields ? student.customFields[field.name] || '' : '';
                    addCustomFieldToForm(field.name, field.type, value);
                });
                
                openModal('studentModal');
            }
        }
        
        function deleteStudent(id) {
            if (confirm('Are you sure you want to delete this student?')) {
                students = students.filter(s => s.id !== id);
                localStorage.setItem('students', JSON.stringify(students));
                renderStudentTable();
                updateDashboard();
                showNotification('Student deleted successfully!', 'success');
            }
        }
        
        function filterStudents() {
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            const rows = document.getElementById('studentTableBody').querySelectorAll('tr');
            
            rows.forEach(row => {
                const name = row.cells[2].textContent.toLowerCase();
                const trade = row.cells[3].textContent.toLowerCase();
                if (name.includes(searchTerm) || trade.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function previewPhoto(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('photoPreview').innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 100%;">`;
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Trade functions
        function showAddTradeForm() {
            document.getElementById('modalTradeTitle').textContent = 'Add New Trade';
            document.getElementById('tradeForm').reset();
            document.getElementById('tradeId').value = '';
            openModal('tradeModal');
        }
        
        function saveTrade(e) {
            e.preventDefault();
            
            const tradeId = document.getElementById('tradeId').value;
            const tradeData = {
                name: document.getElementById('tradeName').value,
                duration: parseFloat(document.getElementById('tradeDuration').value),
                seats: parseInt(document.getElementById('tradeSeats').value),
                department: document.getElementById('tradeDepartment').value,
                description: document.getElementById('tradeDescription').value
            };
            
            if (tradeId) {
                // Update existing trade
                const index = trades.findIndex(t => t.id === parseInt(tradeId));
                if (index !== -1) {
                    trades[index] = { ...trades[index], ...tradeData };
                    showNotification('Trade updated successfully!', 'success');
                }
            } else {
                // Add new trade
                const newId = trades.length > 0 ? Math.max(...trades.map(t => t.id)) + 1 : 1;
                trades.push({ id: newId, ...tradeData });
                showNotification('Trade added successfully!', 'success');
            }
            
            localStorage.setItem('trades', JSON.stringify(trades));
            renderTradeList();
            updateDashboard();
            
            // Update trade dropdowns
            populateTradeDropdowns();
            
            closeModal('tradeModal');
        }
        
        function renderTradeList() {
            const list = document.getElementById('tradeList');
            list.innerHTML = '';
            
            trades.forEach(trade => {
                const item = document.createElement('li');
                item.className = 'trade-item';
                item.innerHTML = `
                    <div>
                        <strong>${trade.name}</strong>
                        <div>Duration: ${trade.duration} years | Seats: ${trade.seats} | Department: ${trade.department}</div>
                        ${trade.description ? `<div>${trade.description}</div>` : ''}
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn edit-btn" onclick="editTrade(${trade.id})"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn" onclick="deleteTrade(${trade.id})"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                list.appendChild(item);
            });
        }
        
        function editTrade(id) {
            const trade = trades.find(t => t.id === id);
            if (trade) {
                document.getElementById('modalTradeTitle').textContent = 'Edit Trade';
                document.getElementById('tradeId').value = trade.id;
                document.getElementById('tradeName').value = trade.name;
                document.getElementById('tradeDuration').value = trade.duration;
                document.getElementById('tradeSeats').value = trade.seats;
                document.getElementById('tradeDepartment').value = trade.department;
                document.getElementById('tradeDescription').value = trade.description || '';
                
                openModal('tradeModal');
            }
        }
        
        function deleteTrade(id) {
            if (confirm('Are you sure you want to delete this trade?')) {
                // Check if any students are enrolled in this trade
                const studentsInTrade = students.filter(s => s.tradeId === id);
                if (studentsInTrade.length > 0) {
                    showNotification('Cannot delete trade. There are students enrolled in this trade.', 'error');
                    return;
                }
                
                trades = trades.filter(t => t.id !== id);
                localStorage.setItem('trades', JSON.stringify(trades));
                renderTradeList();
                updateDashboard();
                showNotification('Trade deleted successfully!', 'success');
            }
        }
        
        // User functions
        function showAddUserForm() {
            document.getElementById('modalUserTitle').textContent = 'Create New User';
            document.getElementById('userForm').reset();
            document.getElementById('userId').value = '';
            document.getElementById('tradeSelectionField').style.display = 'none';
            openModal('userModal');
        }
        
        function saveUser(e) {
            e.preventDefault();
            
            const userId = document.getElementById('userId').value;
            const password = document.getElementById('userPassword').value;
            const confirmPassword = document.getElementById('userConfirmPassword').value;
            
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            const userData = {
                username: document.getElementById('userUsername').value,
                password: password,
                role: document.getElementById('userRole').value,
                email: document.getElementById('userEmail').value
            };
            
            // Add assigned trade for teachers
            if (userData.role === 'teacher') {
                userData.assignedTrade = parseInt(document.getElementById('userTrade').value);
            }
            
            if (userId) {
                // Update existing user
                const index = users.findIndex(u => u.id === parseInt(userId));
                if (index !== -1) {
                    users[index] = { ...users[index], ...userData };
                    showNotification('User updated successfully!', 'success');
                }
            } else {
                // Check if username already exists
                if (users.some(u => u.username === userData.username)) {
                    showNotification('Username already exists', 'error');
                    return;
                }
                
                // Add new user
                const newId = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;
                users.push({ id: newId, ...userData });
                showNotification('User created successfully!', 'success');
            }
            
            localStorage.setItem('users', JSON.stringify(users));
            renderUserTable();
            closeModal('userModal');
        }
        
        function renderUserTable() {
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.role.charAt(0).toUpperCase() + user.role.slice(1)}</td>
                    <td>${user.assignedTrade ? trades.find(t => t.id === user.assignedTrade)?.name || 'N/A' : 'N/A'}</td>
                    <td>01/01/2023</td>
                    <td><span style="color: green;">Active</span></td>
                    <td class="action-buttons">
                        <button class="action-btn edit-btn" onclick="editUser(${user.id})"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn" onclick="deleteUser(${user.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function editUser(id) {
            const user = users.find(u => u.id === id);
            if (user) {
                document.getElementById('modalUserTitle').textContent = 'Edit User';
                document.getElementById('userId').value = user.id;
                document.getElementById('userUsername').value = user.username;
                document.getElementById('userRole').value = user.role;
                document.getElementById('userEmail').value = user.email || '';
                document.getElementById('userPassword').value = user.password;
                document.getElementById('userConfirmPassword').value = user.password;
                
                if (user.role === 'teacher' && user.assignedTrade) {
                    document.getElementById('userTrade').value = user.assignedTrade;
                    document.getElementById('tradeSelectionField').style.display = 'block';
                } else {
                    document.getElementById('tradeSelectionField').style.display = 'none';
                }
                
                openModal('userModal');
            }
        }
        
        function deleteUser(id) {
            if (confirm('Are you sure you want to delete this user?')) {
                // Prevent deletion of current user
                if (currentUser && currentUser.id === id) {
                    showNotification('You cannot delete your own account', 'error');
                    return;
                }
                
                users = users.filter(u => u.id !== id);
                localStorage.setItem('users', JSON.stringify(users));
                renderUserTable();
                showNotification('User deleted successfully!', 'success');
            }
        }
        
        // Field functions
        function addNewField() {
            const name = document.getElementById('newFieldName').value;
            const type = document.getElementById('newFieldType').value;
            
            if (!name) {
                showNotification('Please enter a field name', 'error');
                return;
            }
            
            // Check if field already exists
            if (fields.some(f => f.name === name)) {
                showNotification('Field already exists', 'error');
                return;
            }
            
            fields.push({ name, type, required: false });
            localStorage.setItem('fields', JSON.stringify(fields));
            renderFieldList();
            document.getElementById('newFieldName').value = '';
            showNotification('Field added successfully!', 'success');
        }
        
        function renderFieldList() {
            const list = document.getElementById('fieldList');
            list.innerHTML = '';
            
            fields.forEach(field => {
                const item = document.createElement('li');
                item.className = 'trade-item';
                item.innerHTML = `
                    <div>
                        <strong>${field.name}</strong>
                        <div>Type: ${field.type} | Required: ${field.required ? 'Yes' : 'No'}</div>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn edit-btn"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn" onclick="deleteField('${field.name}')"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                list.appendChild(item);
            });
        }
        
        function deleteField(name) {
            if (confirm('Are you sure you want to delete this field?')) {
                fields = fields.filter(f => f.name !== name);
                localStorage.setItem('fields', JSON.stringify(fields));
                renderFieldList();
                showNotification('Field deleted successfully!', 'success');
            }
        }
        
        // Bulk upload functions
        function handleExcelUpload(files) {
            if (files.length === 0) return;
            
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            const uploadProgress = document.getElementById('uploadProgress');
            
            uploadProgress.style.display = 'block';
            
            // Simulate processing with progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                progressBar.style.width = `${progress}%`;
                progressPercent.textContent = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Simulate adding students from Excel
                    const newStudents = [
                        { id: students.length > 0 ? Math.max(...students.map(s => s.id)) + 1 : 1, 
                          name: 'Rahul Sharma', tradeId: 1, enrollmentDate: '2023-09-01', status: 'Active' },
                        { id: students.length > 0 ? Math.max(...students.map(s => s.id)) + 2 : 2, 
                          name: 'Sneha Patel', tradeId: 2, enrollmentDate: '2023-09-01', status: 'Active' },
                        { id: students.length > 0 ? Math.max(...students.map(s => s.id)) + 3 : 3, 
                          name: 'Vikram Singh', tradeId: 3, enrollmentDate: '2023-09-01', status: 'Active' }
                    ];
                    
                    students = [...students, ...newStudents];
                    localStorage.setItem('students', JSON.stringify(students));
                    renderStudentTable();
                    updateDashboard();
                    
                    showNotification(`Added ${newStudents.length} students from Excel file`, 'success');
                    
                    // Hide progress bar after a delay
                    setTimeout(() => {
                        uploadProgress.style.display = 'none';
                        progressBar.style.width = '0%';
                        progressPercent.textContent = '0%';
                    }, 2000);
                }
            }, 100);
        }
        
        function downloadTemplate() {
            showNotification('Downloading template...', 'success');
            
            // Create a simple CSV template for download
            const templateData = [
                ['ID', 'Name', 'Trade', 'Email', 'Phone', 'Enrollment Date', 'Status'],
                ['', '', '', '', '', '', '']
            ];
            
            const csvContent = templateData.map(row => row.join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'student_template.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Dashboard functions
        function updateDashboard() {
            document.getElementById('totalStudents').textContent = students.length;
            
            // Calculate new students this month
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const newThisMonth = students.filter(s => {
                const enrollDate = new Date(s.enrollmentDate);
                return enrollDate.getMonth() === currentMonth && enrollDate.getFullYear() === currentYear;
            }).length;
            
            document.getElementById('newStudents').textContent = `+${newThisMonth} this month`;
            
            document.getElementById('totalTrades').textContent = trades.length;
            const departments = [...new Set(trades.map(t => t.department))];
            document.getElementById('tradeInfo').textContent = `Across ${departments.length} departments`;
            
            document.getElementById('attendanceRate').textContent = '89%';
            document.getElementById('newApplications').textContent = students.filter(s => s.status === 'Applied').length;
        }
        
        // Navigation
        const sidebarItems = document.querySelectorAll('.sidebar-menu li');
        const pages = document.querySelectorAll('.page');
        
        sidebarItems.forEach(item => {
            item.addEventListener('click', function() {
                const pageId = this.getAttribute('data-page');
                
                // Update active menu item
                sidebarItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                // Show selected page
                pages.forEach(page => {
                    page.classList.remove('active');
                    if (page.id === pageId) {
                        page.classList.add('active');
                    }
                });
            });
        });
        
        // Initialize the application when the DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved images
            loadSavedImages();
            
            // Initialize the app
            init();
            
            // Show home page by default
            showHomePage();
        });
    </script>
</body>
</html>